<h1 align="center"> Genarris </h1>

<p align="center">
  <img width="500" src="assets/Genarris_logo.png" alt="Genarris Logo">
</p>

<p align="center">
  <a href="https://github.com/Yi5817/Genarris/releases"><img src="https://img.shields.io/badge/version-3.0.0-green" alt="Version 3.0.0"></a>
  <a href="https://www.python.org/downloads/"><img src="https://img.shields.io/badge/python-3.8%2B-blue" alt="Python 3.8+"></a>
  <a href="https://github.com/Yi5817/Genarris/actions/workflows/lint.yml"><img src="https://github.com/Yi5817/Genarris/actions/workflows/lint.yml/badge.svg" alt="Code Style"></a>
  <a href="LICENSE"><img src="https://img.shields.io/badge/license-BSD--3--Clause-blue" alt="License"></a>
</p>


Genarris `gnrs` is a random molecular crystal structure generator.

## Installation

### Prerequisites

- **Python 3.8+**
- **C Compiler with MPI support**
  
### Environment Setup

1. **Clone the repository**:

   ```bash
   git clone https://github.com/Yi5817/Genarris.git
   cd Genarris
   git submodule update --init --recursive
   ```

2. **Create and activate the conda environment**:

   ```bash
   conda create -n gnrs_env python=3.11
   conda activate gnrs_env
   ```

### Install MPI Support

Install `mpi4py` with the MPI compiler:

```bash
MPICC=$(which mpicc) pip install mpi4py==3.1.5
```

> **Note**: On high-performance computing machine, C MPI compiler may differ. Please refer to the [mpi4py documentation](https://mpi4py.readthedocs.io/en/stable/install.html) or contact the system administrator.

### Install `gnrs`

   ```bash
   pip install .
   ```

   > **Note**: `mpicc` is used to build the C extensions. To use a specific MPI compiler, modify the `mpi_compiler` variable in the [setup.py](./setup.py) file.

### Optional Energy Calculators

> **Note**: Users are welcome to implement additional calculators under `gnrs/energy/`

- **[MACE-OFF](https://github.com/ACEsuit/mace)** - Machine learning interatomic potential
- **[FHI-aims](https://fhi-aims.org/)** - All-electron DFT code ([ASE docs](https://wiki.fysik.dtu.dk/ase/ase/calculators/FHI-aims.html))
- **[VASP](https://www.vasp.at/)** - Plane-wave DFT package ([ASE docs](https://wiki.fysik.dtu.dk/ase/ase/calculators/vasp.html))
- **[DFTB+](https://dftbplus.org/)** - Density functional tight binding ([ASE docs](https://wiki.fysik.dtu.dk/ase/ase/calculators/dftb.html))

## Usage

Genarris uses a [configuration file](https://docs.python.org/3/library/configparser.html) to control crystal structure generation and selection.

### Basic Workflow

1. **Create a configuration file**
   
   Here's an example with key parameters for `generation` and `symm_rigid_press` steps:

   ```ini
   [master]
   name                        = 
   molecule_path               = [""]
   Z                           = 
   log_level                   = info

   [workflow]
   tasks                       = ['generation', 'symm_rigid_press']

   [generation]
   num_structures_per_spg      = 4000
   sr                          = 0.95
   # sr is an alias for specific_radius_proportion
   max_attempts_per_spg        = 100000000
   tol                         = 0.01
   unit_cell_volume_mean       = predict
   volume_mult                 = 1.5 
   max_attempts_per_volume     = 10000000
   spg_distribution_type       = standard
   generation_type             = crystal
   natural_cutoff_mult         = 1.2

   [symm_rigid_press]
   sr                           = 0.85
   method                       = BFGS
   tol                          = 0.01
   natural_cutoff_mult          = 1.2
   debug_flag                   = False
   maxiter                      = 5000

   [experimental_structure]
   path = ""
   ```
2. **Prepare your input molecule geometry file** (any format supported by `ase.io.read()`)
3. **Run Genarris with MPI parallelization**:

   ```bash
   mpirun -np <num_processes> gnrs --config <config_file>
   ```

   For example, to run with 8 processes:
   ```bash
   mpirun -np 8 gnrs --config ui.conf
   ```

### Case Studies

The [cases](./cases) directory contains crystal structure prediction (CSP) results for 6 organic molecules studied in the [Genarris 3.0 paper](https://doi.org/10.26434/chemrxiv-2025-046zn). Each case includes:
- **Generated structures**: CIF files of crystal structures generated by Genarris and relaxed using MACE-OFF23 and PBE+MBD methods
- **Experimental structures**: From CSD
- **Analysis data**: Relative lattice energies from MACE-OFF23 and PBE+MBD methods

For detailed results and analysis, see the individual case directories:
- [Aspirin](./cases/aspirin)
- [ε-CL-20](./cases/CL-20)
- [2,4-DNI](./cases/DNI)
- [δ-HMX](./cases/HMX)
- [Target I](./cases/Target-I)
- [Target XXII](./cases/Target_XXII)
  
## Citation

If you use Genarris, please cite our papers:
```bibtex
@article{genarrisv3,
    author = {Yang, Yi and Tom, Rithwik and Wui, Jose AGL and Moussa, Jonathan E and Marom, Noa},
    title = {Genarris 3.0: Generating Close-Packed Molecular Crystal Structures with Rigid Press},
    journal = {ChemRxiv},
    year = {2025},
    url = {https://doi.org/10.26434/chemrxiv-2025-046zn},
    doi = {10.26434/chemrxiv-2025-046zn}
}

@article{genarrisv2,
  title={Genarris 2.0: A random structure generator for molecular crystals},
  author={Tom, Rithwik and Rose, Timothy and Bier, Imanuel and O’Brien, Harriet and V{\'a}zquez-Mayagoitia, {\'A}lvaro and Marom, Noa},
  journal={Computer Physics Communications},
  volume={250},
  pages={107170},
  year={2020},
  publisher={Elsevier}
}

@article{pymove,
  title={Machine learned model for solid form volume estimation based on packing-accessible surface and molecular topological fragments},
  author={Bier, Imanuel and Marom, Noa},
  journal={The Journal of Physical Chemistry A},
  volume={124},
  number={49},
  pages={10330--10345},
  year={2020},
  publisher={ACS Publications}
}
```

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## Feedback and Support

We would appreciate it if you could share any feedback about performance and improvements.

## LICENSE

Genarris is available under the [BSD-3-Clause License](LICENSE).
